<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 钱包转账 Demo - Ethers.js v6</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <h1>🦊 Web3 Wallet</h1>
            </div>
            
            <!-- 钱包信息区 -->
            <div class="wallet-controls">
                <button id="connectBtn" class="btn btn-primary">连接 MetaMask</button>
                
                <div id="walletSection" class="wallet-section" style="display: none;">
                    <!-- 网络切换 -->
                    <div class="network-selector">
                        <label for="networkSwitch">🌐</label>
                        <select id="networkSwitch" class="network-select">
                            <option value="1">Ethereum Mainnet</option>
                            <option value="11155111">Sepolia Testnet</option>
                            <option value="137">Polygon Mainnet</option>
                            <option value="56">BSC Mainnet</option>
                        </select>
                    </div>
                    
                    <!-- 钱包地址显示 -->
                    <div class="wallet-display">
                        <div class="wallet-info-compact">
                            <span class="network-badge" id="currentNetwork">Ethereum</span>
                            <span class="wallet-address" id="walletAddress">0x0000...0000</span>
                        </div>
                        <button id="disconnectBtn" class="btn btn-disconnect">断开</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- 钱包详细信息 -->
        <div id="walletInfo" class="section wallet-details" style="display: none;">
            <h2>💼 钱包信息</h2>
            <div class="info-grid">
                <div class="info-item">
                    <label>地址:</label>
                    <div class="info-value">
                        <span id="fullAddress">-</span>
                        <button id="copyAddressBtn" class="btn-icon" title="复制地址">📋</button>
                    </div>
                </div>
                <div class="info-item">
                    <label>余额:</label>
                    <span class="info-value"><span id="balance">0</span> ETH</span>
                </div>
                <div class="info-item">
                    <label>网络:</label>
                    <span class="info-value" id="networkName">-</span>
                </div>
                <div class="info-item">
                    <label>Chain ID:</label>
                    <span class="info-value" id="chainId">-</span>
                </div>
            </div>
        </div>

        <!-- 转账区域 -->
        <div class="section">
            <h2>💸 发送加密转账</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="recipientAddress">接收地址:</label>
                    <input type="text" id="recipientAddress" placeholder="0x..." class="input-field">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="amount">转账金额 (ETH):</label>
                        <input type="number" id="amount" step="0.001" placeholder="0.01" class="input-field">
                    </div>
                </div>
                <div class="form-group">
                    <label for="message">消息 (将被加密为16进制):</label>
                    <input type="text" id="message" placeholder="转账备注信息" class="input-field">
                    <small>💡 此消息将使用 XOR 加密并转换为16进制数据存储在链上</small>
                </div>
                <button id="sendBtn" class="btn btn-success btn-large" disabled>
                    <span>🚀 发送交易</span>
                </button>
                <div id="txStatus" class="status-box"></div>
            </div>
        </div>

        <!-- 查询交易历史 -->
        <div class="section">
            <h2>📜 查询交易历史</h2>
            <div class="query-methods">
                <div class="method-card" id="ethersMethod">
                    <h3>📡 Ethers.js v6</h3>
                    <p>直接从区块链节点查询交易数据</p>
                    <button id="fetchEthersBtn" class="btn btn-info" disabled>使用 Ethers.js 查询</button>
                </div>
                <div class="method-card" id="graphMethod">
                    <h3>🔍 The Graph</h3>
                    <p>使用 GraphQL 从索引数据库查询</p>
                    <button id="fetchGraphBtn" class="btn btn-warning" disabled>使用 The Graph 查询</button>
                </div>
            </div>
            <div class="data-source-indicator">
                <span>数据来源: <strong id="dataSource">-</strong></span>
            </div>
            <div id="txHistory" class="tx-history"></div>
        </div>

        <!-- 加密/解密工具 -->
        <div class="section">
            <h2>🔐 加密/解密工具</h2>
            <div class="crypto-tools">
                <div class="tool-section">
                    <h3>加密工具</h3>
                    <div class="form-group">
                        <label for="plainText">明文:</label>
                        <textarea id="plainText" placeholder="输入要加密的文本" class="textarea-field" rows="3"></textarea>
                    </div>
                    <button id="encryptBtn" class="btn btn-secondary">🔒 加密为16进制</button>
                    <div class="form-group">
                        <label for="encryptedText">密文 (16进制):</label>
                        <textarea id="encryptedText" placeholder="加密后的16进制数据" class="textarea-field" rows="3" readonly></textarea>
                    </div>
                </div>
                
                <div class="tool-section">
                    <h3>解密工具</h3>
                    <div class="form-group">
                        <label for="hexToDecrypt">16进制密文:</label>
                        <textarea id="hexToDecrypt" placeholder="输入16进制密文 (可以包含0x前缀)" class="textarea-field" rows="3"></textarea>
                    </div>
                    <button id="decryptBtn" class="btn btn-secondary">🔓 解密</button>
                    <div class="form-group">
                        <label for="decryptedText">解密结果:</label>
                        <textarea id="decryptedText" placeholder="解密后的明文" class="textarea-field" rows="3" readonly></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- 功能说明 -->
        <div class="section info-section">
            <h2>📖 功能说明</h2>
            <div class="features-grid">
                <div class="feature-item">
                    <h4>🔌 钱包连接</h4>
                    <p>连接 MetaMask 钱包，支持多网络切换</p>
                </div>
                <div class="feature-item">
                    <h4>💰 加密转账</h4>
                    <p>发送 ETH 并附带加密消息，数据以16进制存储</p>
                </div>
                <div class="feature-item">
                    <h4>📊 双重查询</h4>
                    <p>使用 Ethers.js 或 The Graph 查询链上数据</p>
                </div>
                <div class="feature-item">
                    <h4>🔐 自动解密</h4>
                    <p>读取交易时自动解密16进制消息</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Built with Ethers.js v6 | ⚠️ 仅供学习使用，请在测试网络上测试</p>
    </footer>

    <script type="module" src="app.js"></script>
</body>
</html>
