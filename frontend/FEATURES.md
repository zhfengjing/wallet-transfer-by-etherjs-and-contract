# 功能说明文档

## 核心功能概述

本项目实现了一个功能完整的 Web3 钱包转账应用，支持 MetaMask 钱包连接和两种不同的转账方式。

---

## 1. MetaMask 钱包集成

### 1.1 连接钱包
- **按钮位置**: 导航栏右上角
- **连接方式**: 只支持 MetaMask（injected provider）
- **连接流程**:
  1. 点击 "Connect MetaMask" 按钮
  2. MetaMask 弹出连接请求
  3. 用户确认后自动连接

### 1.2 余额显示
- **显示位置**: 
  - 导航栏账户按钮中（精确到 4 位小数）
  - 账户下拉菜单中（精确到 6 位小数 + 完整值）
- **单位**: ETH
- **实时更新**: 余额会自动刷新
- **格式示例**:
  ```
  导航栏: 0.1234 ETH
  菜单: 0.123456 ETH
  完整: 0.123456789012345678 ETH
  ```

### 1.3 网络切换
- **支持的网络**:
  - ✅ Sepolia Testnet (测试网)
  - ✅ Ethereum Mainnet (主网)
  - ✅ Goerli Testnet (测试网)
  - ✅ Localhost (本地开发)
  
- **切换方式**:
  1. 点击网络选择器（显示当前网络）
  2. 从下拉菜单选择目标网络
  3. MetaMask 自动切换网络

- **网络指示器**:
  - 🟢 绿色点: Sepolia
  - 🔵 蓝色点: Mainnet
  - 🟡 黄色点: 其他网络

### 1.4 账户切换
- **触发方式**: 点击 "切换账户" 按钮
- **实现原理**: 调用 MetaMask 的 `wallet_requestPermissions` 方法
- **用户体验**: 
  1. 点击 "切换账户"
  2. MetaMask 弹出账户选择界面
  3. 选择账户后自动切换

### 1.5 断开连接
- **按钮位置**: 账户下拉菜单底部（红色）
- **操作结果**: 清除连接状态，返回未连接界面

### 1.6 地址复制
- **功能**: 一键复制钱包地址
- **按钮位置**: 账户下拉菜单中地址旁边
- **反馈**: 弹出提示 "地址已复制到剪贴板！"

---

## 2. 直接转账功能 (Direct Transfer)

### 2.1 功能特点
- 使用原生 ETH 转账
- 通过 Infura RPC 节点发送交易
- 无需智能合约

### 2.2 操作流程
1. 输入接收地址（0x...）
2. 输入转账金额（ETH）
3. 点击 "Send Transaction"
4. 在 MetaMask 中确认交易
5. 等待交易确认

### 2.3 界面元素
- **余额卡片**: 蓝色渐变，显示钱包余额
- **转账表单**: 
  - 接收地址输入框
  - 金额输入框
  - 提交按钮
- **交易状态**:
  - 待确认: "Confirming in wallet..."
  - 处理中: "Processing..."
  - 成功: 显示交易 Hash

### 2.4 交易历史
- 显示最近的链上交易
- 点击 "Refresh" 刷新
- 显示区块号和交易 Hash

---

## 3. 合约转账功能 (Contract Transfer)

### 3.1 功能特点
- 使用 WalletTransfer 智能合约
- 支持存款、转账、提款
- The Graph 索引交易历史

### 3.2 存款功能
- **位置**: 左侧卡片
- **流程**:
  1. 输入存款金额
  2. 点击 "Deposit"
  3. 在 MetaMask 确认
  4. 资金存入合约

### 3.3 合约转账
- **位置**: 右侧卡片
- **流程**:
  1. 输入接收地址
  2. 输入转账金额
  3. 点击 "Transfer"
  4. 在 MetaMask 确认
  5. 合约内部转账

### 3.4 余额显示
- **合约余额卡片**: 紫色渐变
- **显示内容**: 用户在合约中的余额
- **实时更新**: 交易后自动刷新

### 3.5 The Graph 集成
- **功能**: 查询交易历史
- **数据源**: Subgraph 索引的链上事件
- **显示信息**:
  - 交易类型（发送/接收）
  - 金额（ETH）
  - 发送/接收地址
  - 时间戳
  - 区块号
  - 交易 Hash（可点击跳转 Etherscan）

---

## 4. UI/UX 设计

### 4.1 配色方案
- **主背景**: 深色渐变（灰色 → 蓝色 → 灰色）
- **直接转账**: 蓝色主题
- **合约转账**: 紫色主题
- **成功状态**: 绿色
- **错误状态**: 红色

### 4.2 交互设计
- **按钮状态**:
  - 正常: 渐变色
  - 悬停: 颜色加深
  - 禁用: 灰色
  - 加载: 显示加载文本

- **下拉菜单**:
  - 点击外部自动关闭
  - 平滑展开动画
  - 高亮当前选项

### 4.3 响应式设计
- 桌面端优化布局
- 支持移动端显示
- 自适应卡片网格

---

## 5. 技术实现

### 5.1 Wagmi Hooks 使用
- `useAccount()` - 账户信息
- `useConnect()` - 连接钱包
- `useDisconnect()` - 断开连接
- `useBalance()` - 查询余额
- `useSwitchChain()` - 切换网络
- `useChainId()` - 获取当前网络 ID
- `useSendTransaction()` - 发送交易
- `useReadContract()` - 读取合约
- `useWriteContract()` - 写入合约

### 5.2 状态管理
- **本地状态**: React useState
- **全局状态**: Jotai atoms
- **服务器状态**: React Query

### 5.3 错误处理
- 钱包未连接提示
- 交易失败提示
- 网络切换失败处理
- The Graph 查询失败提示

---

## 6. 安全考虑

### 6.1 交易安全
- 所有交易需要 MetaMask 确认
- 显示交易详情
- 用户可以在 MetaMask 中查看 gas 费用

### 6.2 输入验证
- 地址格式验证
- 金额格式验证
- 余额充足性检查

### 6.3 合约安全
- 使用 OpenZeppelin 库
- ReentrancyGuard 防重入
- Ownable 权限控制

---

## 7. 性能优化

### 7.1 数据获取
- 使用 React Query 缓存
- 余额自动刷新
- 交易后手动刷新

### 7.2 UI 优化
- TailwindCSS JIT 编译
- 组件懒加载
- 避免不必要的重渲染

---

## 8. 用户体验亮点

### 8.1 清晰的状态反馈
- 连接状态显示
- 交易进度提示
- 成功/失败消息

### 8.2 便捷的操作
- 一键切换网络
- 一键切换账户
- 一键复制地址

### 8.3 美观的界面
- 现代化设计
- 渐变色彩
- 流畅动画

---

## 9. 扩展功能建议

### 9.1 已实现
- ✅ MetaMask 连接
- ✅ 网络切换
- ✅ 账户切换
- ✅ 余额显示（ETH）
- ✅ 直接转账
- ✅ 合约转账
- ✅ The Graph 集成

### 9.2 可扩展
- ⬜ 支持 ERC20 代币转账
- ⬜ 交易历史导出
- ⬜ 多语言支持
- ⬜ 暗色/亮色主题切换
- ⬜ 交易通知推送
- ⬜ ENS 域名解析
- ⬜ 交易费用估算
- ⬜ 批量转账功能
